<script>
    // Free cloud storage for confessions
    const BIN_ID = 'your-bin-id-here'; // You'll get this after setup
    const API_KEY = '$2a$10$your-api-key-here'; // You'll get this too
    
    let confessions = [];
    
    // DOM elements
    const confessionForm = document.getElementById('confessionForm');
    const confessionWall = document.getElementById('confessionWall');
    const emptyWall = document.getElementById('emptyWall');
    
    // Load confessions from cloud
    async function loadConfessions() {
        try {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: {
                    'X-Master-Key': API_KEY
                }
            });
            const data = await response.json();
            confessions = data.record.confessions || [];
            displayConfessions();
        } catch (error) {
            console.log('Loading default confessions');
            confessions = [];
            displayConfessions();
        }
    }
    
    // Save confessions to cloud
    async function saveConfessions() {
        try {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': API_KEY
                },
                body: JSON.stringify({ confessions: confessions })
            });
        } catch (error) {
            console.error('Error saving:', error);
        }
    }
    
    // Display confessions
    function displayConfessions() {
        confessionWall.innerHTML = '';
        
        if (confessions.length === 0) {
            emptyWall.style.display = 'block';
            confessionWall.appendChild(emptyWall);
            return;
        }
        
        emptyWall.style.display = 'none';
        confessions.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        confessions.forEach(confession => {
            const confessionCard = document.createElement('div');
            confessionCard.className = 'confession-card';
            confessionCard.innerHTML = `
                <p class="confession-text">${confession.message}</p>
                <p class="confession-author">- ${confession.name}</p>
                <p class="confession-date">${new Date(confession.date).toLocaleDateString()}</p>
            `;
            confessionWall.appendChild(confessionCard);
        });
    }
    
    // Handle form submission
    confessionForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = document.getElementById('secretName').value.trim() || 'Anonymous';
        const message = document.getElementById('confessionMessage').value.trim();
        
        if (!message) {
            alert('Please write a confession before submitting.');
            return;
        }
        
        const newConfession = {
            name: name,
            message: message,
            date: new Date().toISOString()
        };
        
        confessions.push(newConfession);
        await saveConfessions();
        confessionForm.reset();
        displayConfessions();
    });
    
    // Initial load
    loadConfessions();
</script>
